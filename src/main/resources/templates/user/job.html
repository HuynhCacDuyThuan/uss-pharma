<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Việc làm & Tin tức - USS Pharma</title>
<meta name="description"
	content="Việc làm CÔNG TY TNHH DƯỢC PHẨM QUỐC TẾ USS">
<meta name="keywords"
	content="Việc làm CÔNG TY TNHH DƯỢC PHẨM QUỐC TẾ USS">
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
	rel="stylesheet">
<link th:href="@{/css/index.css}" rel="stylesheet">
<link th:href="@{/css/catergory.css}" rel="stylesheet">
<link th:href="@{/css/footer.css}" rel="stylesheet">
<link th:href="@{/css/product.css}" rel="stylesheet">
<link rel="stylesheet"
	th:href="@{https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css}">
<link rel="stylesheet"
	th:href="@{https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css}">

<link th:href="@{/css/product.css}" rel="stylesheet">
<!-- Bootstrap CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<!-- Bootstrap Icons -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
	rel="stylesheet">

<style>
.floating-contact {
	position: fixed;
	bottom: 20px;
	right: 20px; /* Align to the right */
	display: flex;
	flex-direction: column; /* Align icons vertically */
	gap: 15px; /* Add space between icons */
	z-index: 9999; /* Ensure it's on top */
}
i.bi.bi-telephone {
    color: red;
}
/* Style for each contact icon */
.floating-contact .contact-icon {
	background-color: #ff4d4d;
	color: white;
	border-radius: 50%;
	font-size: 24px;
	padding: 10px;
	display: flex;
	justify-content: center;
	align-items: center;
	width: 50px; /* Set width */
	height: 50px; /* Set height */
	box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Optional: add shadow */
	cursor: pointer;
	transition: transform 0.3s ease;
}

.floating-contact .contact-icon:hover {
	transform: scale(1.1); /* Slightly increase size on hover */
}

/* Styling for the Zalo image icon */
.floating-contact .contact-icon img {
	width: 30px;
	height: 30px;
}

body {
	background-color: #f8f9fc;
	font-family: 'Segoe UI', sans-serif;
}

.card {
	transition: all 0.3s ease;
}

.card:hover {
	transform: translateY(-5px);
	box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
}

.text-primary {
	color: #0046be !important;
}

.btn-outline-primary {
	border-color: #0046be;
	color: #0046be;
}

.btn-outline-primary:hover {
	background-color: #0046be;
	color: white;
}
</style>
</head>
<body>
	<th:block th:replace="~{fragments/header :: header}"></th:block>
	<div class="container py-5 mt-5">
		<div class="row">
			<!-- Cột trái: Việc làm -->
			<div class="col-lg-12">
				<h4 class="mb-4 text-primary">
					<i class="bi bi-briefcase"></i> Cơ hội việc làm
				</h4>
				<div class="row g-4">
					<!-- Job 1 -->


					<!-- Job 2 -->

					<th:block th:each="job : ${jobs}">
						<!-- Job 3 -->
						<div class="col-md-4">
							<div class="card shadow-sm border-0 p-4">
								<div class="text-center mb-3">
									<img
										src="https://ctyduocphamquocteuss.com/wp-content/uploads/2025/03/logo-1024x576.png"
										alt="USS Pharma" style="max-height: 40px;">
								</div>
								<h5 class="text-center fw-bold" th:text="${job.jobTitle}">Nhân
									viên giao hàng</h5>
								<p class="text-center text-danger fw-semibold mb-2">
									<i class="bi bi-fire"></i> Hot
								</p>
								<p class="text-center text-muted mb-2"
									th:text="${job.shortDescription}">Lương: 8 triệu</p>
								<p class="text-center mb-0">
									<a href="#"
										class="text-primary text-decoration-none fw-semibold"
										th:text="${job.position}"> 102 Trần Hưng Đạo, Hà Nội </a>
								</p>
								<p class="text-center text-muted mb-2 mt-2">
    <i class="bi bi-telephone"></i> 0935 096339 - 0768 535379
</p>
							</div>
							
						</div>
				</div>
				</th:block>
			</div>



		</div>
	</div>
	<th:block th:replace="~{fragments/footer-user :: footer-user}"></th:block>
	<div class="floating-contact">
		<!-- Zalo -->
		<div class="chat-toggle contact-icon" onclick="toggleChatBox()">
			<i class="fas fa-comment-dots"></i>
		</div>
		<!-- Facebook -->
		<!-- Facebook -->
		<a href="https://www.facebook.com/profile.php?id=61553924450827" target="_blank"
			class="contact-icon"> <i class="fab fa-facebook-f"></i>
		</a>
		<!-- TikTok -->
		<a href="https://www.tiktok.com/@uss.pharmaco" target="_blank"
			class="contact-icon"> <i class="fab fa-tiktok"></i>
		</a>
		<!-- YouTube -->
		<a href="https://www.youtube.com/@CONGTYTNHHDUOCPHAMQUOCTEUSS?sttick=0"
			target="_blank" class="contact-icon"> <i class="fab fa-youtube"></i>
		</a>


	</div>

	<!-- Font Awesome Icons -->
	<div id="miniChatBox" class="chat-box">
		<div class="chat-header">
			<strong>Hỗ trợ trực tuyến</strong> <span onclick="toggleChatBox()"
				class="chat-close">&times;</span>

		</div>
		<div class="chat-body" id="chatBody">
			<ul id="chatList">
				<!-- List of predefined questions -->
				<li class="chat-question" onclick="showAnswer(this)">Xin chào!
					Bạn cần hỗ trợ gì?</li>
				<li class="chat-question" onclick="showAnswer(this)">Liên hệ
					với chúng tôi</li>
				<li th:each="msg : ${chatMessages}" th:text="${msg.content}"
					th:class="${msg.sender.username} == ${username} ? 'chat-message me' : 'chat-message user'">
				</li>
				</li>
			</ul>
		</div>
		<div class="chat-input">
			<!-- Check if the user is authenticated -->
			<div sec:authorize="hasAnyRole('ROLE_ADMIN', 'ROLE_USER')">
				<input type="text" id="chatMessage" placeholder="Nhập tin nhắn..." />
				<button onclick="sendMessage()">Gửi</button>
			</div>

			<!-- If not authenticated, show the login modal -->
			<div sec:authorize="!isAuthenticated()">
				<input type="text" id="chatMessage" placeholder="Nhập tin nhắn..." />
				<button onclick="showLoginModal()">Gửi</button>
			</div>
		</div>
	</div>
	<div class="modal fade" id="loginModal" tabindex="-1"
		aria-labelledby="loginModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="loginModalLabel">Vui lòng đăng
						nhập để chat</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">Để gửi tin nhắn, bạn cần đăng nhập
					trước.</div>
				<div class="modal-footer">

					<a href="/login" class="btn btn-primary">Đăng nhập</a>
				</div>
			</div>
		</div>
	</div>
	<script
		src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.2/dist/sockjs.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@7.0.0/bundles/stomp.umd.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	</script>


	<script>
		let stompClient = null;
		let connected = false; // Track if the WebSocket is connected

		// Connect to WebSocket using SockJS
		// Connect to WebSocket using SockJS
		function connectWebSocket() {
			const socket = new SockJS('/ws'); // This should match your server-side "/ws" endpoint
			stompClient = StompJs.Stomp.over(socket);
			stompClient.connect({}, function(frame) {
				console.log('Connected: ' + frame);
				connected = true; // Set the connected flag to true after a successful connection
				subscribeToMessages(); // Subscribe to receive messages
			}, function(error) {
				console.error('Error connecting to WebSocket: ', error);
				connected = false; // Set connected flag to false if connection fails
			});
		}

		// Send a message using WebSocket
		function sendMessage() {
			const messageInput = document.getElementById("chatMessage");
			const messageContent = messageInput.value.trim();
			const senderUsername = document.getElementById("loggedInUser").textContent
					.trim();
			const receiverUsername = '0928666622'; // hoặc biến receiver nếu là dynamic

			if (!connected || !messageContent)
				return;

			const chatMessage = {
				senderUsername : senderUsername,
				receiverUsername : receiverUsername,
				content : messageContent
			};

			// ❌ KHÔNG append message tại đây nữa
			stompClient.send("/app/chat.send", {}, JSON.stringify(chatMessage));
			messageInput.value = "";
		}

		function subscribeToMessages() {
			const receiverUsername = '0928666622'; // hoặc dùng biến nếu động

			stompClient
					.subscribe(
							`/topic/messages/${receiverUsername}`,
							function(messageOutput) {
								const message = JSON.parse(messageOutput.body);
								const sender = document
										.getElementById("loggedInUser").textContent
										.trim();
								const chatList = document
										.getElementById("chatList");

								// Tạo thẻ <li> đúng theo format giống Thymeleaf
								const li = document.createElement("li");
								li.textContent = message.content;

								// Gán class theo người gửi
								if (message.senderUsername === sender) {
									li.className = "chat-message me";
								} else {
									li.className = "chat-message user";
								}

								chatList.appendChild(li);
								chatList.scrollTop = chatList.scrollHeight;
							});
		}

		// Initialize WebSocket connection when the page loads
		window.onload = function() {
			connectWebSocket();
			subscribeToMessages();

		};

		// Show login modal if user is not authenticated
		function showLoginModal() {
			const myModal = new bootstrap.Modal(document
					.getElementById('loginModal'));
			myModal.show();
		}

		function toggleChatBox() {
			const chatBox = document.getElementById("miniChatBox");
			chatBox.style.display = chatBox.style.display === "none"
					|| chatBox.style.display === "" ? "flex" : "none";
		}

		function showAnswer(element) {
			const questionText = element.textContent;
			let answerText = "";

			// Define answers to the questions
			switch (questionText) {
			case "Xin chào! Bạn cần hỗ trợ gì?":
				answerText = "Chúng tôi cung cấp các dịch vụ hỗ trợ trực tuyến, vui lòng đăng nhập để nhắn tin trực tuyến.";
				break;
			case "Giới thiệu sản phẩm của bạn":
				answerText = "Đê biết thêm chi tiết cụ thể sản.";
				break;
			case "Thông tin thanh toán":
				answerText = "Chúng tôi chấp nhận thanh toán qua nhiều phương thức, bao gồm thẻ tín dụng và chuyển khoản ngân hàng.";
				break;
			case "Cách sử dụng website":
				answerText = "Bạn có thể tìm kiếm sản phẩm, thêm vào giỏ hàng và thanh toán trực tiếp trên website.";
				break;
			case "Liên hệ với chúng tôi":
				answerText = "Bạn có thể liên hệ qua email usspharmaco3007@gmail.com hoặc gọi số hotline: 092 866 66 22";
				break;
			default:
				answerText = "Xin lỗi, chúng tôi không có câu trả lời cho câu hỏi này.";
			}

			// Create the answer element
			const answer = document.createElement("div");
			answer.classList.add("chat-answer");
			answer.textContent = answerText;

			// Append the answer at the end of the chat body, not after the question
			const chatBody = document.getElementById("chatBody");
			chatBody.appendChild(answer);

			// Ensure the new answer is visible
			answer.style.display = "block";

			// Scroll the chat body to the bottom
			chatBody.scrollTop = chatBody.scrollHeight;
		}
	</script>
</body>
</html>
