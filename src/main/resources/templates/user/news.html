<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tin tức</title>
<meta name="description"
	content="Tin tức CÔNG TY TNHH DƯỢC PHẨM QUỐC TẾ USS">
<meta name="keywords"
	content="Tin tức CÔNG TY TNHH DƯỢC PHẨM QUỐC TẾ USS">
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
	rel="stylesheet">
<link th:href="@{/css/index.css}" rel="stylesheet">
<link th:href="@{/css/catergory.css}" rel="stylesheet">
<link th:href="@{/css/footer.css}" rel="stylesheet">
<link th:href="@{/css/product.css}" rel="stylesheet">
<link rel="stylesheet"
	th:href="@{https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css}">

<link rel="stylesheet"
	th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css}">
<link th:href="@{/css/product.css}" rel="stylesheet">
<style>
.card-img-top {
	width: 30%; /* Set the width to 50% of the container */
	height: 200px; /* Adjust the height as needed */
	object-fit: cover;
	/* Ensures the image covers the area without stretching */
	margin: 0 auto; /* Centers the image horizontally within the card */
	border-radius: inherit;
}

.news-description {
	font-size: 12px;
}

.mt-50 {
	margin-top: 51px;
}
/* Default Flexbox Row */
.card {
	display: flex;
	flex-direction: row;
	border-radius: inherit;
}

/* Responsive behavior */
@media ( max-width : 767px) {
	.card-img-top {
		width: 100%; /* Set the width to 100% on mobile screens */
	}
	.card {
		flex-direction: column;
		/* Stack the image and content vertically on small screens */
	}
}

.custom-heading {
	position: relative;
	display: inline-block;
	padding-bottom: 5px; /* Adds space between text and the underline */
	color: #03a9f4;
}

.product-name {
	text-decoration: none; /* Remove underline */
	color: #003087 !important; /* Set a dark color for the link */
	font-size: 14px; /* Adjust the font size */
	font-weight: bold; /* Make the font bold */
	transition: color 0.3s ease, transform 0.3s ease;
	/* Smooth transition for hover effects */
}

.color {
	color: #003087 !important; /* Set a dark color for the link */
}

.custom-heading::after {
	content: '';
	position: absolute;
	bottom: 0;
	left: 0;
	width: 100%;
	border-bottom: 2px dotted #004d9f;
	/* Yellow dotted line under the heading */
}

/* Stylish link with no underline */
a {
	text-decoration: none; /* Removes the underline */
	color: #007bff; /* Set a nice blue color */
	font-weight: 500; /* Slightly bold text for better readability */
	transition: color 0.3s ease; /* Smooth color transition on hover */
}

.position-relative a {
	background-size: cover; /* Ensure the image covers the entire area */
	background-position: center; /* Keep the image centered */
	display: block; /* Make the link a block element */
	height: 250px; /* Set a fixed height */
}

@media ( min-width : 768px) and (max-width: 1024px) {
	.position-relative a {
		height: 220px; /* Adjust height for iPads and tablets */
		background-size: contain;
		background-repeat: no-repeat;
	}
}

@media ( max-width : 767px) {
	.position-relative a {
		height: 200px;
		background-size: contain;
		background-repeat: no-repeat; /* Reduce height on mobile screens */
	}
	.mt-50 {
		margin-top: 11px;
	}
	.mb-4-d {
		margin-bottom: -1.5rem !important;
	}
}

.floating-contact {
	position: fixed;
	bottom: 20px;
	right: 20px; /* Align to the right */
	display: flex;
	flex-direction: column; /* Align icons vertically */
	gap: 15px; /* Add space between icons */
	z-index: 9999; /* Ensure it's on top */
}

.news-description p:nth-of-type(2) {
	white-space: nowrap;
	/* Prevent the text from wrapping to the next line */
	overflow: hidden; /* Hide overflow content */
	text-overflow: ellipsis; /* Add '...' when the text is too long */
	display: block; /* Ensure the paragraph behaves as a block element */
	width: 100%; /* Make the container span the full available width */
	max-width: 100%; /* Adjust as necessary */
	font-size: 12px;
}

.news-description p {
	display: -webkit-box;
	-webkit-line-clamp: 4; /* Limit to 2 lines */
	-webkit-box-orient: vertical; /* Necessary for line clamping */
	overflow: hidden;
}

h5.card-title {
	font-size: 14px;
	color: #2b3991;
}

.news-description p:not(:first-of-type) {
	display: none; /* Hide all paragraphs except the first one */
}
/* Style for each contact icon */
.floating-contact .contact-icon {
	background-color: #ff4d4d;
	color: white;
	border-radius: 50%;
	font-size: 24px;
	padding: 10px;
	display: flex;
	justify-content: center;
	align-items: center;
	width: 50px; /* Set width */
	height: 50px; /* Set height */
	box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Optional: add shadow */
	cursor: pointer;
	transition: transform 0.3s ease;
}

.floating-contact .contact-icon:hover {
	transform: scale(1.1); /* Slightly increase size on hover */
}

/* Styling for the Zalo image icon */
.floating-contact .contact-icon img {
	width: 30px;
	height: 30px;
}
</style>
</head>
<body>
	<th:block th:replace="~{fragments/header :: header}"></th:block>
	<div class="container-fuild mt-4">

		<div class="row">
			<!-- Main Image Banner -->
			<div class="col-12 mt-50 mb-4 mb-4-d">
				<div class="position-relative">
					<a href="#"
						style="background-image: url(/assets/img/quang-cao.jpg)"></a>
				</div>
			</div>
		</div>

		<div class="container">
			<div class="row">
				<!-- Product Column -->


				<!-- News Item Column -->
				<div class="col-md-9  mb-4">
					<h5 class="custom-heading">Tin tức</h5>
					<tr th:each="news : ${newsList}">
				
						<div class="card mb-2">
							<img th:src="@{'/loadImage?imageName=' + ${news.mainImageUrl}}"
								class="card-img-top" alt="Firestorm Mode">
							<div class="card-body p-2">
								<div class="d-flex flex-column">
									<h5 class="card-title mb-1">
										
										<a class="color" th:href="@{/chi-tiet-bai-viet/{title}(title=${news.title})}" th:text="${news.title}"></a>
									</h5>
									<div class="meta-info d-flex align-items-center mb-1">
										<span class="category me-2"> <a
											href="https://mauweb.monamedia.net/motgame/category/tin-tuc/"
											class="badge bg-primary">TIN TỨC</a>
										</span> <span class="author-date small text-muted"> <time
												th:text="${news.formattedCreatedAt}"></time>
										</span>
									</div>
									<div class="news-description small" th:utext="${news.content}"></div>
								</div>
							</div>
						</div>
					</tr>
					
					  <nav class="mt-4 text-center">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                <a class="page-link" th:href="@{/tin-tuc(page=${currentPage - 1})}">&laquo;</a>
            </li>

            <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                th:classappend="${i} == ${currentPage} ? 'active'">
                <a class="page-link" th:href="@{/tin-tuc(page=${i})}" th:text="${i + 1}">1</a>
            </li>

            <li class="page-item" th:classappend="${currentPage + 1 >= totalPages} ? 'disabled'">
                <a class="page-link" th:href="@{/tin-tuc(page=${currentPage + 1})}">&raquo;</a>
            </li>
        </ul>
    </nav>
				</div>
				<div class="col-md-3 mb-4">
					<div class="product-section">
						<h5 class="custom-heading">Sản phẩm</h5>
						<div th:each="product : ${productList}" class="product-card mb-2">
							<img th:src="@{'/loadImage?imageName=' + ${product.imageUrl}}"
								alt="Product Image" class="img-fluid"
								style="max-height: 140px; width: auto; object-fit: contain;">
							<div class="card-body p-2">

								<a th:href="@{/chi-tiet-san-pham/{id}(id=${product.id})}"
									class="product-name color1" th:text="${product.name}"></a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>


	</div>
	<div class="floating-contact">
		<!-- Zalo -->
<div class="chat-toggle contact-icon" onclick="toggleChatBox()">
			<i class="fas fa-comment-dots"></i>
		</div>
		<!-- Facebook -->
			<!-- Facebook -->
		<a href="https://www.facebook.com/profile.php?id=61553924450827" target="_blank"
			class="contact-icon"> <i class="fab fa-facebook-f"></i>
		</a>
		<!-- TikTok -->
		<a href="https://www.tiktok.com/@uss.pharmaco" target="_blank"
			class="contact-icon"> <i class="fab fa-tiktok"></i>
		</a>
		<!-- YouTube -->
		<a href="https://www.youtube.com/@CONGTYTNHHDUOCPHAMQUOCTEUSS?sttick=0"
			target="_blank" class="contact-icon"> <i class="fab fa-youtube"></i>
		</a>
		
	</div>
	<th:block th:replace="~{fragments/footer-user :: footer-user}"></th:block>
	<div id="miniChatBox" class="chat-box">
    <div class="chat-header">
        <strong>Hỗ trợ trực tuyến</strong> <span onclick="toggleChatBox()" class="chat-close">&times;</span>
  
    </div>
    <div class="chat-body" id="chatBody">
        <ul id="chatList">
            <!-- List of predefined questions -->
            <li class="chat-question" onclick="showAnswer(this)">Xin chào! Bạn cần hỗ trợ gì?</li>
            <li class="chat-question" onclick="showAnswer(this)">Liên hệ với chúng tôi</li>
      <li th:each="msg : ${chatMessages}"
      th:text="${msg.content}"
      th:class="${msg.sender.username} == ${username} ? 'chat-message me' : 'chat-message user'">
  </li>
</li>
        </ul>
    </div>
   <div class="chat-input">
    <!-- Check if the user is authenticated -->
<div sec:authorize="hasAnyRole('ROLE_ADMIN', 'ROLE_USER')">
    <input type="text" id="chatMessage" placeholder="Nhập tin nhắn..." />
    <button onclick="sendMessage()">Gửi</button>
</div>
    
    <!-- If not authenticated, show the login modal -->
    <div sec:authorize="!isAuthenticated()">
      <input type="text" id="chatMessage" placeholder="Nhập tin nhắn..." />
        <button onclick="showLoginModal()">Gửi</button>
    </div>
</div>
</div>
	<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">Vui lòng đăng nhập để chat</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Để gửi tin nhắn, bạn cần đăng nhập trước.
            </div>
            <div class="modal-footer">
             
                <a href="/login" class="btn btn-primary">Đăng nhập</a>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.2/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@7.0.0/bundles/stomp.umd.min.js"></script>
	<!-- Bootstrap JS -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
		
<script>
	let stompClient = null;
	let connected = false;  // Track if the WebSocket is connected

	// Connect to WebSocket using SockJS
	// Connect to WebSocket using SockJS
function connectWebSocket() {
    const socket = new SockJS('/ws');  // This should match your server-side "/ws" endpoint
    stompClient = StompJs.Stomp.over(socket); 
    stompClient.connect({}, function (frame) {
        console.log('Connected: ' + frame);
        connected = true;  // Set the connected flag to true after a successful connection
        subscribeToMessages();  // Subscribe to receive messages
    }, function (error) {
        console.error('Error connecting to WebSocket: ', error);
        connected = false;  // Set connected flag to false if connection fails
    });
}


	// Send a message using WebSocket
	function sendMessage() {
    const messageInput = document.getElementById("chatMessage");
    const messageContent = messageInput.value.trim();
    const senderUsername = document.getElementById("loggedInUser").textContent.trim();
    const receiverUsername = '0928666622'; // hoặc biến receiver nếu là dynamic

    if (!connected || !messageContent) return;

    const chatMessage = {
        senderUsername: senderUsername,
        receiverUsername: receiverUsername,
        content: messageContent
    };

    // ❌ KHÔNG append message tại đây nữa
    stompClient.send("/app/chat.send", {}, JSON.stringify(chatMessage));
    messageInput.value = "";
}

	function subscribeToMessages() {
	    const receiverUsername = '0928666622'; // hoặc dùng biến nếu động

	    stompClient.subscribe(`/topic/messages/${receiverUsername}`, function (messageOutput) {
	        const message = JSON.parse(messageOutput.body);
	        const sender = document.getElementById("loggedInUser").textContent.trim();
	        const chatList = document.getElementById("chatList");

	        // Tạo thẻ <li> đúng theo format giống Thymeleaf
	        const li = document.createElement("li");
	        li.textContent = message.content;

	        // Gán class theo người gửi
	        if (message.senderUsername === sender) {
	            li.className = "chat-message me";
	        } else {
	            li.className = "chat-message user";
	        }

	        chatList.appendChild(li);
	        chatList.scrollTop = chatList.scrollHeight;
	    });
	}

	// Initialize WebSocket connection when the page loads
	window.onload = function() {
	    connectWebSocket();
	    subscribeToMessages();
	
	};

	// Show login modal if user is not authenticated
	function showLoginModal() {
	    const myModal = new bootstrap.Modal(document.getElementById('loginModal'));
	    myModal.show();
	}

	function toggleChatBox() {
	    const chatBox = document.getElementById("miniChatBox");
	    chatBox.style.display = chatBox.style.display === "none" || chatBox.style.display === "" ? "flex" : "none";
	}

	
	
	function showAnswer(element) {
	    const questionText = element.textContent;
	    let answerText = "";

	    // Define answers to the questions
	    switch (questionText) {
	        case "Xin chào! Bạn cần hỗ trợ gì?":
	            answerText = "Chúng tôi cung cấp các dịch vụ hỗ trợ trực tuyến, vui lòng đăng nhập để nhắn tin trực tuyến.";
	            break;
	        case "Giới thiệu sản phẩm của bạn":
	            answerText = "Đê biết thêm chi tiết cụ thể sản.";
	            break;
	        case "Thông tin thanh toán":
	            answerText = "Chúng tôi chấp nhận thanh toán qua nhiều phương thức, bao gồm thẻ tín dụng và chuyển khoản ngân hàng.";
	            break;
	        case "Cách sử dụng website":
	            answerText = "Bạn có thể tìm kiếm sản phẩm, thêm vào giỏ hàng và thanh toán trực tiếp trên website.";
	            break;
	        case "Liên hệ với chúng tôi":
	            answerText = "Bạn có thể liên hệ qua email usspharmaco3007@gmail.com hoặc gọi số hotline: 092 866 66 22";
	            break;
	        default:
	            answerText = "Xin lỗi, chúng tôi không có câu trả lời cho câu hỏi này.";
	    }

	    // Create the answer element
	    const answer = document.createElement("div");
	    answer.classList.add("chat-answer");
	    answer.textContent = answerText;

	    // Append the answer at the end of the chat body, not after the question
	    const chatBody = document.getElementById("chatBody");
	    chatBody.appendChild(answer);

	    // Ensure the new answer is visible
	    answer.style.display = "block";

	    // Scroll the chat body to the bottom
	    chatBody.scrollTop = chatBody.scrollHeight;
	}

	

</script>
</body>
</html>
